import{Q as g}from"./QToolbarTitle.5ecfa0aa.js";import{Q as _}from"./QSpace.fb5f89a7.js";import{_ as f,A as i,n as l,p as h,q as o,d as s,b6 as y,Z as u,V as b,X as k,a1 as p,am as d,aq as q,$,S,aO as w}from"./index.9022de34.js";import{Q as x}from"./QToolbar.2a2e526c.js";import{Q as v}from"./QForm.a6c6ef66.js";import{l as Q}from"./index.4f152a18.js";const C={name:"StripeComponents",data(){return{loading:!1,data:[],customer_id:"",client_secret:"",dialog:!1,render_loading:!0,publish_key:"",return_url:location.host,stripe:void 0,elements:void 0,cardElement:void 0,full_name:""}},setup(){return{}},created(){},methods:{PaymentRender(e){this.data=e,this.createAccount()},createAccount(){i.showLoadingBox(this.$t("Creating accont"),this.$q),i.PaymentPost("createMerchantAccount",this.data).then(e=>{this.customer_id=e.details.customer_id,this.subscribeAccount()}).catch(e=>{i.notify("dark",e,"error",this.$q)}).then(e=>{i.hideLoadingBox(this.$q)})},subscribeAccount(){i.showLoadingBox(this.$t("Subscribing"),this.$q),i.PaymentPost("Stripeubscribeaccount",{customer_id:this.customer_id,merchant_uuid:this.data.merchant_uuid,payment_code:this.data.payment_code,package_uuid:this.data.package_uuid}).then(e=>{this.client_secret=e.details.client_secret,this.publish_key=e.details.publish_key,this.return_url=e.details.origin+"/#/signup/validate-payment",this.dialog=!0}).catch(e=>{i.notify("dark",e,"error",this.$q)}).then(e=>{i.hideLoadingBox(this.$q)})},whenShow(){this.initStripe()},initStripe(){Q("https://js.stripe.com/v3/").then(()=>{this.renderCard()}).catch(()=>{})},renderCard(){console.log("renderCard"),this.render_loading=!0,this.stripe=Stripe(this.publish_key),this.elements=this.stripe.elements();let e={},t=this.elements.create("card",{style:e});this.cardElement=t,setTimeout(()=>{t.mount(this.$refs.card_element)},100),setTimeout(()=>{this.render_loading=!1},500)},Subscribe(){this.loading=!0,this.elements,console.log(this.client_secret),this.stripe.confirmCardPayment(this.client_secret,{payment_method:{card:this.cardElement,billing_details:{name:this.full_name}}}).then(e=>{this.loading=!1,console.log(e),e.error?i.notify("dark",e.error.message,"error",this.$q):this.validatePayment(e.paymentIntent.id)})},validatePayment(e){i.showLoadingBox(this.$t("Validating payment"),this.$q),i.PaymentPost("Stripevalidatepayment",{payment_intent:e,merchant_uuid:this.data.merchant_uuid,payment_code:this.data.payment_code,package_uuid:this.data.package_uuid}).then(t=>{let n=t.details.status,c=t.details.message;n=="succeeded"?this.$router.push("/signup/thankyou"):n=="processing"?this.$router.push("/signup/payment-processing"):n=="requires_payment_method"&&i.notify("dark",c,"error",this.$q)}).catch(t=>{i.notify("dark",t,"error",this.$q)}).then(t=>{i.hideLoadingBox(this.$q)})}}},B={class:"q-pl-md q-pr-md q-mb-sm"},P={ref:"card_element",id:"card-element"},V={key:0,class:"flex flex-center text-center"};function A(e,t,n,c,a,m){return l(),h(w,{modelValue:a.dialog,"onUpdate:modelValue":t[2]||(t[2]=r=>a.dialog=r),position:"bottom",onShow:m.whenShow},{default:o(()=>[s(y,{class:"rounded-borders-top"},{default:o(()=>[s(x,{class:"text-primary top-toolbar q-pl-md",dense:""},{default:o(()=>[s(g,{class:u(["text-darkx text-weight-bold",{"text-white":e.$q.dark.mode,"text-dark":!e.$q.dark.mode}]),style:{overflow:"inherit"}},{default:o(()=>[b(k(e.$t("Enter your card details")),1)]),_:1},8,["class"]),s(_),s(p,{onClick:t[0]||(t[0]=r=>a.dialog=!1),color:"white",square:"",unelevated:"","text-color":"grey",icon:"las la-times",dense:"","no-caps":"",size:"sm",class:"border-grey radius8"})]),_:1}),s(v,{onSubmit:m.Subscribe},{default:o(()=>[d("div",B,[s(q,{modelValue:a.full_name,"onUpdate:modelValue":t[1]||(t[1]=r=>a.full_name=r),label:e.$t("Card name"),outlined:"","stack-label":"",color:"grey-5",rules:[r=>r&&r.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),d("div",{class:u(["q-mb-lg q-pt-sm q-pa-md",{"bg-mygrey text-dark":e.$q.dark.mode,"bg-white text-black":!e.$q.dark.mode}])},[d("div",P,null,512)],2),a.render_loading?(l(),$("div",V,[s(S,{color:"primary",size:"2em"})])):(l(),h(p,{key:1,type:"submit",color:"primary","text-color":"white",label:e.$t("Subscribe"),unelevated:"",class:"full-width",size:"lg","no-caps":"",loading:a.loading},null,8,["label","loading"]))])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue","onShow"])}var D=f(C,[["render",A]]);export{D as default};
