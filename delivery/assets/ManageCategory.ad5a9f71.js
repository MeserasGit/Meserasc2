import{_ as w,aw as _,u as E,A as i,m as y,n as l,p as d,q as h,d as o,a1 as u,$ as c,V as D,X as f,F as k,ap as b,Y as S,Z as p,am as g,a9 as I,aq as Q,ax as q}from"./index.9022de34.js";import{Q as T}from"./QToolbarTitle.5ecfa0aa.js";import{Q as B}from"./QToolbar.2a2e526c.js";import{Q as U}from"./QHeader.522a2ada.js";import{Q as O}from"./QInnerLoading.788e47b1.js";import{Q as A}from"./QImg.ad5480e5.js";import{Q as F}from"./QSpace.fb5f89a7.js";import{Q as v}from"./QSelect.311841ab.js";import{Q as j}from"./QFooter.864bb069.js";import{Q as z}from"./QForm.a6c6ef66.js";import{Q as x}from"./QPage.a79a1249.js";import{Q as L}from"./QPullToRefresh.dea2c8d3.js";import{A as C}from"./AppCamera.caf1710c.js";import{u as N}from"./AccessStore.4066b28f.js";import"./QResizeObserver.129b050c.js";import"./QChip.6eb513c3.js";import"./QItemLabel.4dae639c.js";import"./QMenu.d414cf74.js";import"./selection.5d84a74a.js";import"./rtl.b51694b1.js";import"./format.3e32b8d9.js";import"./TouchPan.f449f070.js";import"./touch.3df10340.js";const R={name:"ManageCategory",components:{ConfirmDialog:_(()=>q(()=>import("./ConfirmDialog.d3b3cd57.js"),["assets/ConfirmDialog.d3b3cd57.js","assets/QToolbarTitle.5ecfa0aa.js","assets/index.9022de34.js","assets/index.8b19a20e.css","assets/QToolbar.2a2e526c.js"])),UploaderFile:_(()=>q(()=>import("./UploaderFile.48fb90ea.js"),["assets/UploaderFile.48fb90ea.js","assets/QUploader.49fdd1be.js","assets/index.9022de34.js","assets/index.8b19a20e.css","assets/QCircularProgress.54b08c59.js","assets/format.3e32b8d9.js"])),ItemTranslation:_(()=>q(()=>import("./ItemTranslation.b0a39d0a.js"),["assets/ItemTranslation.b0a39d0a.js","assets/index.9022de34.js","assets/index.8b19a20e.css","assets/QSpace.fb5f89a7.js","assets/QExpansionItem.ea7db586.js","assets/QItemLabel.4dae639c.js","assets/QSlideTransition.3f201d8d.js","assets/QList.da851dcd.js"]))},data(){return{cat_id:0,category_name:"",category_description:"",status:"publish",dish:[],status_list:[],loading:!1,loading_get:!1,data_dialog:{title:this.$t("Delete Confirmation"),subtitle:this.$t("Are you sure you want to permanently delete the selected item?"),cancel:this.$t("Cancel"),confirm:this.$t("Delete")},upload_enabled:!1,featured_filename:"",featured_url:"",upload_path:"",fields:[{name:"name",title:this.$t("Enter name"),type:"text"},{name:"description",title:this.$t("Enter description"),type:"textarea"}],translation_data:[],translation:[],photo_data:""}},setup(e){const t=E(),n=N();return{DataStore:t,AccessStore:n}},computed:{isEdit(){return this.cat_id>0},hasPhoto(){return this.cat_id>0?!i.empty(this.featured_filename):!1},hasData(){return Object.keys(this.photo_data).length>0}},created(){this.cat_id=this.$route.query.cat_id,this.cat_id>0&&this.getCategory()},methods:{refresh(e){this.cat_id>0?this.getCategory(e):e()},getCategory(e){this.loading_get=!0,i.fetchDataByTokenPost("getCategory","cat_id="+this.cat_id).then(t=>{this.category_name=t.details.category_name,this.category_description=t.details.category_description,this.status=t.details.status,this.featured_filename=t.details.photo,this.featured_url=t.details.photo_url,this.upload_path=t.details.path,this.translation=t.details.translation;const n=t.details.dish_selected;Object.keys(t.details.dish_selected).length>0&&Object.entries(this.DataStore.dish_list).forEach(([m,a])=>{n.includes(a.value)&&this.dish.push(a)})}).catch(t=>{i.notify("dark",t,"error",this.$q)}).then(t=>{this.loading_get=!1,i.empty(e)||e()})},afterInput(e){this.translation_data=e},onSubmit(){this.loading=!0;const e=[];Object.keys(this.dish).length>0&&Object.entries(this.dish).forEach(([t,n])=>{e.push(n.value)}),i.fetchDataByToken("addCategory",{cat_id:this.cat_id,category_name:this.category_name,category_description:this.category_description,status:this.status.value?this.status.value:this.status,dish:e,featured_filename:this.featured_filename,upload_path:this.upload_path,file_data:this.hadData()?this.photo_data.data:"",image_type:this.hadData()?this.photo_data.format:"",translation_data:this.translation_data}).then(t=>{i.notify(this.$q.dark.mode?"grey600":"light-green",t.msg,"check_circle",this.$q),this.$router.push("/menu?refresh=1")}).catch(t=>{i.notify("dark",t,"error",this.$q)}).then(t=>{this.loading=!1})},hadData(){return Object.keys(this.photo_data).length>0},confirmDelete(){this.$refs.confirm_dialog.dialog=!0},afterConfirm(){this.$refs.confirm_dialog.dialog=!1,i.showLoadingBox("",this.$q),i.fetchDataByTokenPost("deleteCategory","cat_id="+this.cat_id).then(e=>{i.notify("light-green",e.msg,"check_circle",this.$q),this.$router.push("/menu?refresh=1")}).catch(e=>{i.notify("dark",e,"error",this.$q)}).then(e=>{i.hideLoadingBox(this.$q)})},takePhoto(){this.$q.capacitor?C.isCameraEnabled().then(e=>{C.isFileAccessEnabled().then(t=>{C.getPhoto(1).then(n=>{this.photo_data=n}).catch(n=>{this.photo_data=[]})}).catch(t=>{i.notify("dark",t,"error",this.$q)})}).catch(e=>{i.notify("dark",e,"error",this.$q)}):this.upload_enabled=!this.upload_enabled},afterUploadfile(e){this.featured_filename=e.filename,this.featured_url=e.url_image,this.upload_path=e.upload_path}}},M={class:"row q-gutter-sm"},G={class:"col"},H={class:"font12 line-normal"},J={class:"q-gutter-md"};function X(e,t,n,m,a,r){const P=y("UploaderFile"),V=y("ItemTranslation"),$=y("ConfirmDialog");return l(),d(L,{onRefresh:r.refresh},{default:h(()=>[o(U,{class:p({"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode})},{default:h(()=>[o(B,null,{default:h(()=>[o(u,{onClick:t[0]||(t[0]=s=>e.$router.back()),flat:"",round:"",dense:"",icon:"las la-angle-left",color:e.$q.dark.mode?"white":"dark"},null,8,["color"]),o(T,{class:"text-weight-bold"},{default:h(()=>[r.isEdit?(l(),c(k,{key:0},[D(f(e.$t("Edit Category")),1)],64)):(l(),c(k,{key:1},[D(f(e.$t("Add Category")),1)],64))]),_:1}),m.AccessStore.hasAccess("food.category_delete")?(l(),c(k,{key:0},[r.isEdit&&!a.loading_get?(l(),d(u,{key:0,round:"",color:e.$q.dark.mode?"grey600":"mygrey","text-color":e.$q.dark.mode?"grey300":"dark",icon:"las la-trash",size:"sm",unelevated:"",onClick:r.confirmDelete},null,8,["color","text-color","onClick"])):b("",!0)],64)):b("",!0)]),_:1}),o(S)]),_:1},8,["class"]),o(x,{class:p([{"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode},"q-pa-md"])},{default:h(()=>[a.loading_get?(l(),d(O,{key:0,showing:!0,color:"primary",size:"md"})):(l(),d(z,{key:1,onSubmit:r.onSubmit},{default:h(()=>[g("div",M,[r.hasData?(l(),d(A,{key:0,src:a.photo_data.path,"spinner-color":"primary","spinner-size":"sm",fit:"cover",style:{height:"70px"},class:"col-3 radius8"},null,8,["src"])):r.hasPhoto?(l(),d(A,{key:1,src:this.featured_url,"spinner-color":"primary",fit:"cover",style:{height:"70px"},class:"col-3 radius8"},null,8,["src"])):(l(),c("div",{key:2,class:p(["col-3 row items-center justify-center radius8",{"bg-grey600 ":e.$q.dark.mode,"bg-mygrey ":!e.$q.dark.mode}]),style:{height:"70px"}},[o(I,{name:"las la-image",class:"text-grey",size:"xl"})],2)),g("div",G,[g("div",H,f(e.$t("Items with quality photos are often more popular. Maximum 2 MB"))+". "+f(e.$t("Accepted types: PNG. JPG")),1),o(u,{label:r.hasPhoto?this.$t("Change Photo"):r.hasData?this.$t("Change Photo"):this.$t("Add Photo"),flat:"",color:"primary","no-caps":"",class:"q-pl-none q-pr-none",onClick:r.takePhoto},null,8,["label","onClick"])])]),a.upload_enabled?(l(),d(P,{key:0,ref:"uploader_file",onAfterUploadfile:r.afterUploadfile},null,8,["onAfterUploadfile"])):b("",!0),o(F,{class:"q-pa-xs"}),g("div",J,[o(Q,{outlined:"",modelValue:a.category_name,"onUpdate:modelValue":t[1]||(t[1]=s=>a.category_name=s),label:e.$t("Name"),"stack-label":"",color:"grey-5","lazy-rules":"",rules:[s=>s&&s.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),o(Q,{outlined:"",type:"textarea",modelValue:a.category_description,"onUpdate:modelValue":t[2]||(t[2]=s=>a.category_description=s),label:e.$t("Description"),"stack-label":"",color:"grey-5"},null,8,["modelValue","label"]),o(v,{outlined:"",modelValue:a.dish,"onUpdate:modelValue":t[3]||(t[3]=s=>a.dish=s),label:e.$t("Dish"),color:"grey-5","stack-label":"",multiple:"",options:m.DataStore.dish_list,behavior:"dialog","transition-show":"fade","transition-hide":"fade"},null,8,["modelValue","label","options"]),o(v,{outlined:"",modelValue:a.status,"onUpdate:modelValue":t[4]||(t[4]=s=>a.status=s),label:e.$t("Status"),color:"grey-5",options:m.DataStore.status_list,"stack-label":"",behavior:"dialog","transition-show":"fade","transition-hide":"fade"},null,8,["modelValue","label","options"]),o(V,{ref:"item_translation",fields:a.fields,update:r.isEdit,data:a.translation,onAfterInput:r.afterInput},null,8,["fields","update","data","onAfterInput"])]),o(j,{class:p(["q-pl-md q-pr-md q-pb-xs",{"bg-mydark ":e.$q.dark.mode,"bg-white ":!e.$q.dark.mode}])},{default:h(()=>[o(u,{type:"submit",color:"primary","text-color":"white",label:e.$t("Submit"),unelevated:"",class:"full-width radius8",size:"lg","no-caps":"",loading:a.loading},null,8,["label","loading"])]),_:1},8,["class"])]),_:1},8,["onSubmit"])),o($,{ref:"confirm_dialog",data:a.data_dialog,onAfterConfirm:r.afterConfirm},null,8,["data","onAfterConfirm"])]),_:1},8,["class"])]),_:1},8,["onRefresh"])}var ke=w(R,[["render",X]]);export{ke as default};
