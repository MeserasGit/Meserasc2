import{_ as v,b3 as b,aw as c,u as D,A as a,an as u,b4 as l,b5 as S,m as d,n as $,p as k,q as r,d as i,ao as y,a1 as A,Z as h,ax as p}from"./index.9022de34.js";import{Q as w}from"./QToolbarTitle.5ecfa0aa.js";import{Q as C}from"./QToolbar.2a2e526c.js";import{Q as q}from"./QHeader.522a2ada.js";import{Q}from"./QFooter.864bb069.js";import{Q as T,a as I}from"./QLayout.1ea82326.js";import{u as O}from"./UserStore.e6e92fbc.js";import{u as V}from"./AccessStore.4066b28f.js";import"./QResizeObserver.129b050c.js";const P=b({name:"MainLayout",components:{TabsMenu:c(()=>p(()=>import("./TabsMenu.c18144a1.js"),["assets/TabsMenu.c18144a1.js","assets/QRouteTab.4d4640a1.js","assets/index.9022de34.js","assets/index.8b19a20e.css","assets/QTabs.a2ac70b0.js","assets/QResizeObserver.129b050c.js","assets/rtl.b51694b1.js","assets/AccessStore.4066b28f.js"])),NotiButton:c(()=>p(()=>import("./NotiButton.3261e248.js"),["assets/NotiButton.3261e248.js","assets/index.9022de34.js","assets/index.8b19a20e.css","assets/QBadge.3c540cd9.js","assets/index.7af6e0f9.js","assets/UserStore.e6e92fbc.js"]))},setup(){const e=D(),t=O(),o=V();return{DataStore:e,UserStore:t,AccessStore:o}},data(){return{online:!1,tab:"home",loading:!1}},created(){this.DataStore.storeAvailable(this.$q.capacitor),this.AccessStore.getRefreshAccess(),this.$q.capacitor&&this.DeviceInit(),this.$q.dark.set(this.DataStore.dark_mode)},watch:{DataStore:{immediate:!0,deep:!0,handler(e,t){e.loading_available||(this.online=this.DataStore.store_available),e.loading||this.checkAppVersion()}}},methods:{searchPage(){this.$route.path=="/menu"?(this.DataStore.search_item="",this.$router.push("/search/food")):this.$router.push("/search")},setOnline(){let e=this.online?"Confirm Going Online":"Confirm Going Offline",t=this.online?this.$t("Are you sure you want to take your business online and start accepting orders again?"):this.$t("Are you sure you want to take your business offline temporarily? This will prevent new orders from coming in. Your current orders will still be processed.");this.$q.dialog({title:this.$t(e),message:t,cancel:!0,persistent:!0,ok:{color:"dark",flat:!0,"no-caps":!0,label:this.$t("Confirm")},cancel:{color:"primary",flat:!0,"no-caps":!0,label:this.$t("Cancel")}}).onOk(()=>{this.DataStore.setStoreAvailable(this.online)}).onCancel(()=>{this.online=!this.online}).onDismiss(()=>{})},DeviceInit(){const e=a.getSession("mt_device_token"),t=a.getSession("mt_device_registered"),o=a.getSession("mt_device_registered_auth");u.authenticated()?o!==1&&l.getId().then(s=>{l.getInfo().then(n=>{this.UserStore.device_uuid=s.identifier,this.updateDevice(e,s.identifier,n.platform)})}):t!==1&&l.getId().then(s=>{l.getInfo().then(n=>{this.UserStore.device_uuid=s.identifier,this.registerDevice(e,s.identifier,n.platform)})}),this.subsribeDevice()},registerDevice(e,t,o){a.registerDevice(e,t,o).then(s=>{a.setSession("mt_device_registered",1)})},updateDevice(e,t,o){a.updateDevice(e,t,o).then(s=>{a.setSession("mt_device_registered_auth",1)})},checkAppVersion(){this.$q.capacitor&&(this.$q.platform.is.android&&this.DataStore.app_version_android>0?this.DataStore.app_version_android>this.DataStore.app_version&&this.$router.replace("/update-app"):this.$q.platform.is.ios&&this.DataStore.app_version_ios>0&&this.DataStore.app_version_ios>this.DataStore.app_version&&this.$router.replace("/update-app"))},subsribeDevice(){let e=u.getUser();e&&!this.DataStore.push_off&&S.subscribeTo({topic:e.merchant_uuid}).then(t=>{this.DataStore.push_notifications=!0}).catch(t=>{this.DataStore.push_notifications=!1,a.notify("dark","Error subscribing topics"+JSON.stringify(t),"warning",this.$q)})}}});function U(e,t,o,s,n,B){const f=d("NotiButton"),m=d("TabsMenu"),_=d("router-view");return $(),k(T,{view:"lHh Lpr lFf"},{default:r(()=>[i(q,{class:h({"bg-mydark text-white":e.$q.dark.mode,"bg-grey-1 text-dark":!e.$q.dark.mode})},{default:r(()=>[i(C,null,{default:r(()=>[i(y,{modelValue:e.online,"onUpdate:modelValue":[t[0]||(t[0]=g=>e.online=g),e.setOnline],color:"primary",label:e.$t("Online")},null,8,["modelValue","label","onUpdate:modelValue"]),i(w),i(f),i(A,{round:"",color:"grey",icon:"search",flat:"",onClick:e.searchPage},null,8,["onClick"])]),_:1})]),_:1},8,["class"]),i(Q,{bordered:"",class:"bg-white text-dark modified-footer"},{default:r(()=>[i(m)]),_:1}),i(I,{class:h({"bg-mydark text-white":e.$q.dark.mode,"bg-grey-1 text-dark":!e.$q.dark.mode})},{default:r(()=>[i(_)]),_:1},8,["class"])]),_:1})}var z=v(P,[["render",U]]);export{z as default};
