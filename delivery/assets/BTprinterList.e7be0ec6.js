import{Q as _}from"./QCircularProgress.54b08c59.js";import{Q as k}from"./QToolbarTitle.5ecfa0aa.js";import{Q as m}from"./QSpace.fb5f89a7.js";import{_ as S,A as d,n as c,p as h,q as r,d as a,b6 as b,ap as v,V as f,X as u,a1 as g,$ as y,F as Q,a0 as w,a3 as B,a4 as T,aO as q,am as x}from"./index.9022de34.js";import{Q as C}from"./QToolbar.2a2e526c.js";import{Q as D}from"./QList.da851dcd.js";import{Q as V}from"./QFooter.864bb069.js";import{A as n}from"./AppBluetooth.7e08b241.js";import"./format.3e32b8d9.js";import"./QResizeObserver.129b050c.js";const $={name:"BTprinterList",data(){return{dialog:!1,loading:!1,data:[],new_data:[],device_list:[],paired_data:[]}},setup(){return{}},watch:{paired_data(e,t){console.log("PAIRED DATA=>"),console.log(JSON.stringify(e)),Object.keys(e).length>0&&Object.entries(e).forEach(([p,s])=>{this.new_data.push({name:s.name,address:s.address}),this.device_list.push(s.address)})},data(e,t){Object.keys(e).length>0&&Object.entries(e).forEach(([p,s])=>{this.device_list.includes(s.address)||this.new_data.push({name:s.name,address:s.address}),this.device_list.push(s.address)})}},methods:{whenShow(){this.device_list=[],this.data=[],this.new_data=[],this.initBT()},setPrinter(e){this.dialog=!1,this.stopScan(),d.showLoadingBox("",this.$q),n.GetServices(e.address).then(t=>{this.disconnectBT(e.address),this.$emit("afterSelectprinter",e,t.services,t.characteristics)}).catch(t=>{d.notify("dark",t,"error",this.$q)}).then(t=>{d.hideLoadingBox(this.$q)})},disconnectBT(e){n.Disconnect(e).then(t=>{}).catch(t=>{}).then(t=>{})},initBT(){n.Enabled().then(e=>{this.retrieveDevice(),setTimeout(()=>{this.Scan()},100)}).catch(e=>{d.notify("dark",e.message,"error",this.$q)}).then(e=>{})},stopScan(){n.StopScan().then(e=>{this.dialog=!1}).catch(e=>{this.dialog=!1}).then(e=>{})},Scan(){this.loading=!0,n.Scan().then(e=>{this.data=e}).catch(e=>{this.data=[],d.notify("dark",e.message,"error",this.$q)}).then(e=>{this.loading=!1})},retrieveDevice(){n.retrieveDevice().then(e=>{this.paired_data=e}).catch(e=>{this.paired_data=[]}).then(e=>{})}}},A=x("div",{class:"col"},null,-1);function L(e,t,p,s,o,l){return c(),h(q,{modelValue:o.dialog,"onUpdate:modelValue":t[1]||(t[1]=i=>o.dialog=i),position:"bottom",onShow:l.whenShow,onHide:l.stopScan,persistent:""},{default:r(()=>[a(b,{class:"rounded-borders-top"},{default:r(()=>[a(C,{class:"text-primary top-toolbar q-pl-md",dense:""},{default:r(()=>[a(k,{class:"text-dark text-weight-bold",style:{overflow:"inherit"}},{default:r(()=>[o.loading?(c(),h(_,{key:0,indeterminate:"",size:"20px",thickness:.22,rounded:"",color:"primary","track-color":"grey-3",class:"q-mr-sm"},null,8,["thickness"])):v("",!0),f(" "+u(e.$t("Bluetooth Printer")),1)]),_:1}),a(m),a(g,{onClick:t[0]||(t[0]=i=>o.dialog=!1),color:"white",square:"",unelevated:"","text-color":"grey",icon:"las la-times",dense:"","no-caps":"",size:"sm",class:"border-grey radius8"})]),_:1}),a(D,{separator:""},{default:r(()=>[(c(!0),y(Q,null,w(o.new_data,i=>(c(),h(B,{key:i,clickable:"",onClick:O=>l.setPrinter(i)},{default:r(()=>[a(T,null,{default:r(()=>[f(u(i.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),a(m,{class:"q-pa-xl"}),a(V,{class:"bg-white border-grey-top q-pa-sm row"},{default:r(()=>[A,a(g,{flat:"",label:e.$t("Cancel"),color:"dark",onClick:l.stopScan,"no-caps":"",class:"col"},null,8,["label","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onShow","onHide"])}var R=S($,[["render",L]]);export{R as default};
