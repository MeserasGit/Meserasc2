import{_ as S,aw as Q,ax as L,u as q,A as O,m as C,n as s,$ as n,F as u,am as p,X as d,d as l,q as a,a0 as g,p as _,a1 as D,V as c,ap as m,S as P,a3 as V,a4 as b,b8 as U}from"./index.9022de34.js";import{Q as w}from"./QSpace.fb5f89a7.js";import{Q as T}from"./QBadge.3c540cd9.js";import{Q as A}from"./QTab.43d13fc7.js";import{Q as B}from"./QTabs.a2ac70b0.js";import{Q as y}from"./QItemLabel.4dae639c.js";import{Q as v}from"./QChip.6eb513c3.js";import{Q as z}from"./QList.da851dcd.js";import{a as I,Q as N}from"./QTabPanels.2669cc39.js";import{u as E}from"./UserStore.e6e92fbc.js";import{u as j}from"./OrderStore.f42348e3.js";import"./QResizeObserver.129b050c.js";import"./rtl.b51694b1.js";import"./use-panel.09edc9f3.js";import"./touch.3df10340.js";import"./selection.5d84a74a.js";import"./use-cache.b0833c75.js";const R={name:"LastOrders",props:["refresh_done"],data(){return{tab:"",loading:!1,data:[],limit:5,status_list:[],item_details:[],order_items:[],settings_tabs:[],order_group_buttons:[],order_buttons:[],services_list:[]}},components:{OrderPreview:Q(()=>L(()=>import("./OrderPreview.b0978c3d.js"),["assets/OrderPreview.b0978c3d.js","assets/index.9022de34.js","assets/index.8b19a20e.css","assets/QToolbarTitle.5ecfa0aa.js","assets/QSpace.fb5f89a7.js","assets/QToolbar.2a2e526c.js","assets/QImg.ad5480e5.js","assets/QItemLabel.4dae639c.js","assets/QList.da851dcd.js","assets/OrderStore.f42348e3.js","assets/PrintTemplate.26cb5c79.js","assets/AppBluetooth.7e08b241.js"]))},setup(){const t=q(),e=E(),k=j();return{DataStore:t,UserStore:e,OrderStore:k}},watch:{tab(t,e){console.log(t),this.DataStore.last_order_tab=t,this.getLastOrder()},refresh_done(t,e){this.getLastOrder(this.refresh_done),this.OrderStore.getCountOrder()},UserStore:{immediate:!0,deep:!0,handler(t,e){Object.keys(t.data_push_receive).length>0&&(console.log("LAST ORDER WATCH"),console.log(t.data_push_receive),t.data_push_receive.notification_type=="order_update"&&(this.getLastOrder(),this.OrderStore.getCountOrder()))}}},computed:{hasData(){return Object.keys(this.data).length>0}},created(){this.tab=this.DataStore.last_order_tab,this.getLastOrder(),this.OrderStore.getCountOrder()},methods:{getLastOrder(t){this.loading=!0,O.fetchDataByTokenPost("OrderList","filter_by="+this.tab+"&limit="+this.limit+"&page=0").then(e=>{this.data=e.details.data,this.status_list=e.details.status_list,this.item_details=e.details.item_details,this.settings_tabs=e.details.settings_tabs,this.order_group_buttons=e.details.order_group_buttons,this.order_buttons=e.details.order_buttons,this.services_list=e.details.services_list}).catch(e=>{this.data=[],this.status_list=[],this.settings_tabs=[],this.order_group_buttons=[],this.order_buttons=[],this.services_list=[]}).then(e=>{this.loading=!1,O.empty(t)||t()})},showPreview(t){this.order_items=t,this.$refs.order_preview.dialog=!0},afterUpdatestatus(){console.log("afterUpdatestatus"),this.getLastOrder(),this.OrderStore.getCountOrder()}}},F={class:"text-h6"},H={class:"text-grey"},W={key:0,class:"flex flex-center full-width q-pa-xl",style:{"min-height":"calc(30vh)"}},X={key:0,class:"flex flex-center",style:{"min-height":"calc(30vh)"}},G={class:"full-width text-center"},J={class:"text-weight-bold"},K={class:"text-grey font12"},M={key:0,class:"blob green q-mb-xs"},Y={key:1,class:"blob red"};function Z(t,e,k,h,r,f){const x=C("OrderPreview");return s(),n(u,null,[h.DataStore.loading?(s(),n(u,{key:0},[],64)):(s(),n(u,{key:1},[p("div",F,d(t.$t("Last Orders")),1),p("div",H,d(t.$t("Quick management of the last 5 orders")),1),l(w,{class:"q-pa-xs"}),l(B,{modelValue:r.tab,"onUpdate:modelValue":e[0]||(e[0]=i=>r.tab=i),dense:"","no-caps":"","active-color":"primary","indicator-color":t.$q.dark.mode?"mydark":"grey-1",align:"justify","narrow-indicator":"",shrink:"","switch-indicator":"false",class:"text-grey"},{default:a(()=>[(s(!0),n(u,null,g(h.DataStore.last_order,i=>(s(),_(A,{key:i,name:i.value,"no-caps":"",class:"no-wrap q-pa-none"},{default:a(()=>[l(D,{label:i.label,unelevated:"","no-caps":"",color:r.tab==i.value?"primary":t.$q.dark.mode?"grey600":"mygrey","text-color":r.tab==i.value?"white":t.$q.dark.mode?"grey300":"dark",class:"radius28 q-mr-sm"},{default:a(()=>[h.OrderStore.foundCountOrder(i.value)?(s(),_(T,{key:0,color:"green-12",floating:"",style:{right:"-2px"}},{default:a(()=>[c(d(h.OrderStore.foundCountOrder(i.value)),1)]),_:2},1024)):m("",!0)]),_:2},1032,["label","color","text-color"])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue","indicator-color"]),l(w,{class:"q-pa-xs"}),l(N,{modelValue:r.tab,"onUpdate:modelValue":e[1]||(e[1]=i=>r.tab=i),animated:"","transition-prev":"fade","transition-next":"fade",style:{"min-height":"calc(30vh)"}},{default:a(()=>[(s(!0),n(u,null,g(h.DataStore.last_order,i=>(s(),_(I,{key:i,name:i.value,class:"q-pa-none"},{default:a(()=>[r.loading?(s(),n("div",W,[l(P,{color:"primary",size:"2em"})])):(s(),n(u,{key:1},[f.hasData?(s(),_(z,{key:1,separator:""},{default:a(()=>[(s(!0),n(u,null,g(r.data,o=>(s(),_(V,{key:o,clickable:"",onClick:$=>f.showPreview(o)},{default:a(()=>[o.is_view=="0"||o.is_critical==!0?(s(),_(b,{key:0,avatar:"",style:{"min-width":"12px","padding-right":"5px"}},{default:a(()=>[o.is_view=="0"?(s(),n("div",M)):m("",!0),o.is_critical==!0?(s(),n("div",Y)):m("",!0)]),_:2},1024)):m("",!0),l(b,null,{default:a(()=>[l(y,{class:"text-weight-medium"},{default:a(()=>[c(d(o.order_id),1)]),_:2},1024),l(y,{caption:""},{default:a(()=>[c(d(o.description),1)]),_:2},1024),l(y,{caption:"",class:"font11"},{default:a(()=>[c(d(o.date_created),1)]),_:2},1024)]),_:2},1024),l(b,{side:""},{default:a(()=>[r.services_list[o.order_type]?(s(),_(v,{key:0,color:t.$q.dark.mode?"grey600":"mygrey","text-color":t.$q.dark.mode?"grey300":"dark",size:"sm",class:"q-ma-none"},{default:a(()=>[c(d(r.services_list[o.order_type].service_name),1)]),_:2},1032,["color","text-color"])):m("",!0),r.status_list[o.status_raw]?(s(),_(v,{key:1,size:"xs",color:"primary","text-color":"white",style:U(`color:${r.status_list[o.status_raw].font_color_hex} !important; background-color:${r.status_list[o.status_raw].background_color_hex} !important; `)},{default:a(()=>[c(d(o.status),1)]),_:2},1032,["style"])):m("",!0),l(v,{size:"xs",color:"mygrey","text-color":"dark"},{default:a(()=>[c(d(o.payment_status_name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(s(),n("div",X,[p("div",G,[p("div",J,d(t.$t("No order")),1),p("p",K,d(t.$t("Order will show here")),1)])]))],64))]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])],64)),l(x,{ref:"order_preview",data:r.order_items,items_details:r.item_details,settings_tabs:r.settings_tabs,order_group_buttons:r.order_group_buttons,order_buttons:r.order_buttons,onAfterUpdatestatus:f.afterUpdatestatus},null,8,["data","items_details","settings_tabs","order_group_buttons","order_buttons","onAfterUpdatestatus"])],64)}var gt=S(R,[["render",Z]]);export{gt as default};
