import{_ as x,aw as g,u as C,A as r,m as y,n as l,$ as m,d as e,q as i,F as k,Z as v,a0 as D,p as P,ap as T,am as d,X as s,a1 as b,ax as $,a3 as A,a4 as B,V as c}from"./index.9022de34.js";import{Q as p}from"./QItemLabel.4dae639c.js";import{Q as E}from"./QList.da851dcd.js";import{Q as F}from"./QInfiniteScroll.0e0d2cfe.js";import{Q as I}from"./QSpace.fb5f89a7.js";import{Q as V}from"./QPageSticky.48ac823d.js";import{Q as O}from"./QPageScroller.ed98b502.js";import{Q as R}from"./QPage.a79a1249.js";import{Q as N}from"./QPullToRefresh.dea2c8d3.js";import{P as z}from"./PrintTemplate.26cb5c79.js";import{A as u}from"./AppBluetooth.7e08b241.js";import"./use-page-sticky.e99d68f4.js";import"./TouchPan.f449f070.js";import"./touch.3df10340.js";import"./selection.5d84a74a.js";import"./format.3e32b8d9.js";const j={name:"InvoiceList",components:{TableSkeleton:g(()=>$(()=>import("./TableSkeleton.dba5d973.js"),["assets/TableSkeleton.dba5d973.js","assets/QSkeleton.5de72ea8.js","assets/index.9022de34.js","assets/index.8b19a20e.css","assets/QItemLabel.4dae639c.js","assets/QList.da851dcd.js"])),TableSummary:g(()=>$(()=>import("./TableSummary.cc883ec0.js"),["assets/TableSummary.cc883ec0.js","assets/QSkeleton.5de72ea8.js","assets/index.9022de34.js","assets/index.8b19a20e.css","assets/swiper.min.86854748.js","assets/swiper.min.b39a1361.css"])),FilterDates:g(()=>$(()=>import("./FilterDates.d18d2fd8.js"),["assets/FilterDates.d18d2fd8.js","assets/QToolbarTitle.5ecfa0aa.js","assets/index.9022de34.js","assets/index.8b19a20e.css","assets/QSpace.fb5f89a7.js","assets/QToolbar.2a2e526c.js","assets/QDate.230591b4.js","assets/use-cache.b0833c75.js","assets/QPopupProxy.ee92b509.js","assets/format.3e32b8d9.js","assets/QMenu.d414cf74.js","assets/selection.5d84a74a.js","assets/QForm.a6c6ef66.js","assets/ClosePopup.6b679ccd.js"])),PrinterList:g(()=>$(()=>import("./PrinterList.7ee09b64.js"),["assets/PrinterList.7ee09b64.js","assets/index.9022de34.js","assets/index.8b19a20e.css","assets/QToolbarTitle.5ecfa0aa.js","assets/QSpace.fb5f89a7.js","assets/QToolbar.2a2e526c.js","assets/QList.da851dcd.js","assets/QFooter.864bb069.js","assets/QResizeObserver.129b050c.js","assets/ClosePopup.6b679ccd.js","assets/UserStore.e6e92fbc.js"]))},setup(){return{DataStore:C()}},created(){this.Summary()},computed:{hasData(){return Object.keys(this.data).length>0}},data(){return{loading:!1,data:[],page:0,status:[],is_refresh:void 0,handle:void 0,date_start:"",date_end:"",printer_details:[],restaurant_name:"",loading_summary:!1}},methods:{refresh(t){this.resetPagination(),this.Summary(),this.is_refresh=t},afterFilter(t){this.date_start=t.date_start,this.date_end=t.date_end,this.resetPagination()},List(t,a){this.loading=!0,r.fetchDataByTokenPost("dailyReportSales","&page="+t+"&date_start="+this.date_start+"&date_end="+this.date_end).then(n=>{n.code==1?(this.page=t,this.data.push(n.details.data)):n.code==3&&(this.data_done=!0,r.empty(this.$refs.nscroll)||this.$refs.nscroll.stop())}).catch(n=>{this.data_done=!0,r.empty(this.$refs.nscroll)||this.$refs.nscroll.stop()}).then(n=>{a(),this.loading=!1,r.empty(this.is_refresh)||this.is_refresh()})},resetPagination(){this.page=0,this.data=[],this.$refs.nscroll.reset(),this.$refs.nscroll.resume(),this.$refs.nscroll.trigger()},Summary(){this.loading_summary=!0,r.fetchDataByTokenPost("getDailySummary").then(t=>{this.data_summary=t.details.data}).catch(t=>{}).then(t=>{this.loading_summary=!1})},showPrinter(){this.$q.capacitor?this.DataStore.osVersion>=12?u.CheckBTConnectPermissionOnly().then(t=>{this.EnabledBT()}).catch(t=>{this.$router.push("/settings/location-enabled")}).then(t=>{}):u.CheckLocationOnly().then(t=>{this.$refs.printer.dialog=!0}).catch(t=>{this.$router.push("/settings/location-enabled")}).then(t=>{}):this.$refs.printer.dialog=!0},afterSelectprinter(t){this.printer_details=t,t.printer_model=="feieyun"?this.FPprint(t):this.$q.capacitor?this.CheckBT():r.notify("dark",this.$t("Bluetooth Printers works only in actual device"),"error",this.$q)},FPprint(t){this.$refs.printer.dialog=!1,r.showLoadingBox(this.$t("Printing..."),this.$q),r.fetchDataByTokenPost("FPprintdailysales","printer_id="+t.printer_id+"&date_start="+this.date_start+"&date_end="+this.date_end).then(a=>{r.notify("green",a.msg,"check",this.$q)}).catch(a=>{r.notify("dark",a,"error",this.$q)}).then(a=>{r.hideLoadingBox(this.$q)})},CheckBT(){u.Enabled().then(t=>{this.BondAndConnect()}).catch(t=>{r.notify("dark",t,"error",this.$q)}).then(t=>{})},BondAndConnect(){this.$refs.printer.dialog=!1,r.showLoadingBox(this.$t("Connecting..."),this.$q),u.Connect(this.printer_details.printer_uuid,this.printer_details.printer_model).then(t=>{this.Print()}).catch(t=>{r.notify("dark",t,"error",this.$q)}).then(t=>{r.hideLoadingBox(this.$q)})},Print(){this.$refs.printer.dialog=!1,this.$q.loading.show({spinnerSize:30,spinnerColor:"primary"}),r.fetchDataByTokenPost("GetDailysales","date_start="+this.date_start+"&date_end="+this.date_end).then(t=>{let a=z.DailySales(this.printer_details.paper_width,t.details.restaurant_name,t.details.range,t.details.data);console.log("TEMPLATE ==>"),console.log(a.tpl_all),console.log(a.tpl_data),Object.keys(a).length>0&&(this.printer_details.printer_model=="sunmi"?this.printData(a.tpl_all):Object.entries(a.tpl_data).forEach(([n,f])=>{r.empty(f)||(n>0?setTimeout(()=>{console.log(f),this.printData(f)},2e3):(console.log(f),this.printData(f)))}))}).catch(t=>{r.notify("dark",t,"error",this.$q)}).then(t=>{this.$q.loading.hide()})},printData(t){r.showLoadingBox(this.$t("Printing..."),this.$q),u.Print(this.printer_details.printer_uuid,t,this.printer_details.printer_model,this.printer_details.service_id,this.printer_details.characteristics).then(a=>{}).catch(a=>{r.notify("dark",a,"error",this.$q)}).then(a=>{r.hideLoadingBox(this.$q)})}}},G={class:"flex flex-center text-center"},M={class:"radius8 bg-green-10 text-white q-pa-xs text-center q-pl-sm q-pr-sm"},X={class:"font14 text-weight-bold"},Z={key:0,class:"full-width text-center flex flex-center",style:{"min-height":"calc(50vh)"}},H={class:"text-grey q-ma-none"},J={class:"column q-gutter-y-sm"};function K(t,a,n,f,_,h){const L=y("TableSummary"),S=y("TableSkeleton"),w=y("FilterDates"),Q=y("PrinterList");return l(),m(k,null,[e(N,{onRefresh:h.refresh},{default:i(()=>[e(R,{class:v([{"bg-mydark text-white":t.$q.dark.mode,"bg-grey-1 text-dark":!t.$q.dark.mode},"q-pr-md q-pl-md q-pt-md"])},{default:i(()=>[e(L,{ref:"table_summary",loading:_.loading_summary,data:t.data_summary,set_slide:2.5},null,8,["loading","data","set_slide"]),e(F,{ref:"nscroll",onLoad:h.List},{default:i(()=>[e(E,{separator:"",class:v(["bg-whitex",{"bg-grey600 text-white":t.$q.dark.mode,"bg-white":!t.$q.dark.mode}])},{default:i(()=>[(l(!0),m(k,null,D(_.data,q=>(l(),m(k,{key:q},[(l(!0),m(k,null,D(q,o=>(l(),P(A,{key:o,clickable:"",to:{path:"/orderview",query:{order_uuid:o.order_uuid}}},{default:i(()=>[e(B,{avatar:"",top:""},{default:i(()=>[d("div",G,[d("div",null,[d("div",M,[d("div",X," #"+s(o.order_id),1)])])])]),_:2},1024),e(B,{top:""},{default:i(()=>[e(p,{caption:"",class:"font12"},{default:i(()=>[c(s(o.date_created),1)]),_:2},1024),e(p,null,{default:i(()=>[c(s(o.service_name)+" - "+s(o.payment_name),1)]),_:2},1024),e(p,{caption:""},{default:i(()=>[c(s(t.$t("Total Sales"))+" : "+s(o.sub_total),1)]),_:2},1024),e(p,{caption:""},{default:i(()=>[c(s(t.$t("Delivery Fee"))+" : "+s(o.delivery_fee),1)]),_:2},1024),e(p,{caption:""},{default:i(()=>[c(s(t.$t("Tax"))+" : "+s(o.tax_total),1)]),_:2},1024),e(p,{caption:""},{default:i(()=>[c(s(t.$t("Tip"))+" : "+s(o.courier_tip),1)]),_:2},1024),e(p,{caption:""},{default:i(()=>[c(s(t.$t("Total"))+" : "+s(o.total),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["to"]))),128))],64))),128))]),_:1},8,["class"])]),loading:i(()=>[_.page<=0?(l(),P(S,{key:0,rows:10})):_.data.length>1?(l(),P(S,{key:1,rows:1})):T("",!0)]),_:1},8,["onLoad"]),!h.hasData&&!_.loading?(l(),m("div",Z,[d("p",H,s(t.$t("No available data")),1)])):T("",!0),e(I,{class:"q-pa-md"}),e(V,{position:"bottom-right",offset:[18,18]},{default:i(()=>[d("div",J,[d("div",null,[e(b,{icon:"o_date_range",round:"",size:"md",color:t.$q.dark.mode?"grey600":"green","text-color":t.$q.dark.mode?"grey300":"white",unelevated:"",onClick:a[0]||(a[0]=q=>this.$refs.filter_date.dialog=!0)},null,8,["color","text-color"])]),d("div",null,[e(b,{icon:"las la-print",round:"",size:"md",color:t.$q.dark.mode?"grey600":"mygrey","text-color":t.$q.dark.mode?"grey300":"dark",unelevated:"",onClick:h.showPrinter,disable:!h.hasData},null,8,["color","text-color","onClick","disable"])])])]),_:1}),e(O,{position:"bottom-right","scroll-offset":150,offset:[18,18]},{default:i(()=>[e(b,{fab:"",icon:"keyboard_arrow_up",color:t.$q.dark.mode?"grey600":"mygrey","text-color":t.$q.dark.mode?"grey300":"dark",dense:"",padding:"3px"},null,8,["color","text-color"])]),_:1})]),_:1},8,["class"])]),_:1},8,["onRefresh"]),e(w,{ref:"filter_date",onAfterFilter:h.afterFilter},null,8,["onAfterFilter"]),e(Q,{ref:"printer",onAfterSelectprinter:h.afterSelectprinter},null,8,["onAfterSelectprinter"])],64)}var ft=x(j,[["render",K]]);export{ft as default};
